#!/bin/bash

set -eu

echo "before if"
if [ "$BUILDKITE_COMMAND" != "buildkite-agent pipeline upload" ] ; then
  echo "inside if"
  export NVM_DIR="$HOME/.nvm"
  mkdir -p $NVM_DIR
  local NVM_SH_PATH="/usr/local/opt/nvm/nvm.sh"
  echo "NVM_SH_PATH: ${NVM_SH_PATH}"
  [[ ! -f "$NVM_SH_PATH" ]] && brew install nvm
  echo "after brew install nvm"
  source $NVM_SH_PATH
  echo "after source nvm"
  nvm install 8.4
  echo "after nvm install"
  nvm use 8.4
  echo "after nvm use"
fi
